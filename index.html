<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion de Factures</title>
    <link rel="stylesheet" href="style.css">

    <!-- jsPDF pour g√©n√©ration PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- SheetJS pour export Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <!-- Modal de connexion/inscription -->
    <div id="auth-modal" class="modal">
        <div class="modal-content">
            <h2>Connexion</h2>
            <p class="auth-subtitle">Connectez-vous pour acc√©der √† vos factures</p>

            <form id="auth-form">
                <div class="form-group">
                    <label for="auth-email">Email:</label>
                    <input type="email" id="auth-email" required placeholder="votre@email.com">
                </div>

                <div class="form-group">
                    <label for="auth-password">Mot de passe:</label>
                    <input type="password" id="auth-password" required placeholder="Minimum 6 caract√®res">
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-primary" id="login-btn">Se connecter</button>
                    <button type="button" class="btn-secondary" id="register-btn">Cr√©er un compte</button>
                </div>

                <p id="auth-error" class="auth-error"></p>
            </form>

            <div id="user-info" class="user-info" style="display: none;">
                <p>Connect√© en tant que: <strong id="user-email"></strong></p>
                <button type="button" class="btn-secondary" id="logout-btn">D√©connexion</button>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>Gestion de Factures</h1>
            <p class="subtitle" id="user-business-name" style="display: none;"></p>
            <div class="user-badge" id="user-badge" style="display: none;">
                <span id="user-badge-email"></span>
                <button class="user-badge-btn" id="user-menu-btn">‚öôÔ∏è</button>
            </div>
        </header>

        <!-- Navigation par onglets -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="factures">Factures</button>
            <button class="tab-btn" data-tab="depenses">D√©penses</button>
            <button class="tab-btn" data-tab="parametres">Param√®tres</button>
        </div>

        <!-- Section Factures -->
        <div id="factures-tab" class="tab-content active">
            <section class="card">
                <h2>Cr√©er une Facture</h2>
                <form id="invoice-form">
                    <div class="form-group">
                        <label for="client-select">S√©lectionner un client:</label>
                        <select id="client-select">
                            <option value="">-- Chargement... --</option>
                        </select>
                    </div>

                    <div id="client-fields" style="display: none;">
                        <div class="form-group">
                            <label for="client-name">Nom du Client: *</label>
                            <input type="text" id="client-name" placeholder="Nom du client">
                        </div>

                        <div class="form-group">
                            <label for="client-email">Email du Client: *</label>
                            <input type="email" id="client-email" placeholder="client@example.com">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="invoice-date">Date de Facturation:</label>
                        <input type="date" id="invoice-date" required>
                    </div>

                    <div class="form-group">
                        <label for="invoice-due-date">Date d'√©ch√©ance:</label>
                        <input type="date" id="invoice-due-date">
                        <small>Laisser vide pour calculer automatiquement (+30 jours)</small>
                    </div>

                    <h3>Lignes de facturation</h3>
                    <div id="sessions-container">
                        <!-- Les lignes seront ajout√©es ici dynamiquement -->
                    </div>
                    <button type="button" id="add-session-btn" class="btn-secondary">+ Ajouter une ligne</button>

                    <div class="form-group total-section">
                        <div class="total-breakdown">
                            <div class="total-line">
                                <label>Sous-total:</label>
                                <span id="invoice-subtotal" class="subtotal-amount">0.00 $</span>
                            </div>
                            <div class="total-line tax-line" id="tps-line" style="display: none;">
                                <label>TPS (<span id="tps-rate-display">5</span>%):</label>
                                <span id="invoice-tps" class="tax-amount">0.00 $</span>
                            </div>
                            <div class="total-line tax-line" id="tvq-line" style="display: none;">
                                <label>TVQ (<span id="tvq-rate-display">9.975</span>%):</label>
                                <span id="invoice-tvq" class="tax-amount">0.00 $</span>
                            </div>
                            <div class="total-line total-final">
                                <label>Total:</label>
                                <span id="invoice-total" class="total-amount">0.00 $</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-primary">G√©n√©rer Facture PDF</button>
                        <button type="button" id="save-draft-btn" class="btn-secondary">Sauvegarder Brouillon</button>
                    </div>
                </form>
            </section>

            <section class="card">
                <h2>Factures Sauvegard√©es</h2>

                <!-- Recherche et filtres -->
                <div class="search-filter-section">
                    <div class="search-bar">
                        <input type="text" id="invoice-search" placeholder="üîç Rechercher par client, num√©ro, montant...">
                    </div>
                    <div class="filter-controls">
                        <select id="invoice-period-filter">
                            <option value="all">Toutes les p√©riodes</option>
                            <option value="this-month">Ce mois</option>
                            <option value="last-month">Mois dernier</option>
                            <option value="this-quarter">Ce trimestre</option>
                            <option value="this-year">Cette ann√©e</option>
                        </select>
                        <select id="invoice-sort">
                            <option value="date-desc">Plus r√©centes</option>
                            <option value="date-asc">Plus anciennes</option>
                            <option value="client-asc">Client (A-Z)</option>
                            <option value="client-desc">Client (Z-A)</option>
                            <option value="amount-desc">Montant (‚Üì)</option>
                            <option value="amount-asc">Montant (‚Üë)</option>
                        </select>
                    </div>
                </div>

                <div class="list-actions">
                    <button id="export-excel-invoices-btn" class="btn-secondary">Export Excel</button>
                    <span id="invoice-count" class="count-badge"></span>
                </div>
                <div id="invoices-list" class="list-container">
                    <p class="empty-state">Aucune facture sauvegard√©e</p>
                </div>
            </section>
        </div>

        <!-- Section D√©penses -->
        <div id="depenses-tab" class="tab-content">
            <section class="card">
                <h2>Ajouter une D√©pense</h2>
                <form id="expense-form">
                    <div class="form-group">
                        <label for="expense-date">Date:</label>
                        <input type="date" id="expense-date" required>
                    </div>

                    <div class="form-group">
                        <label for="expense-description">Description:</label>
                        <input type="text" id="expense-description" required>
                    </div>

                    <div class="form-group">
                        <label for="expense-amount">Montant ($):</label>
                        <input type="number" id="expense-amount" step="0.01" required>
                    </div>

                    <div class="form-group">
                        <label for="expense-category">Cat√©gorie:</label>
                        <select id="expense-category" required>
                            <option value="">S√©lectionner...</option>
                            <option value="equipement">√âquipement</option>
                            <option value="deplacement">D√©placement</option>
                            <option value="formation">Formation</option>
                            <option value="location">Location</option>
                            <option value="autre">Autre</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="expense-photo">Photo (optionnel):</label>
                        <input type="file" id="expense-photo" accept="image/*">
                        <div id="photo-preview" class="photo-preview"></div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-primary">Ajouter D√©pense</button>
                    </div>
                </form>
            </section>

            <section class="card">
                <h2>D√©penses Enregistr√©es</h2>

                <!-- Recherche et filtres -->
                <div class="search-filter-section">
                    <div class="search-bar">
                        <input type="text" id="expense-search" placeholder="üîç Rechercher par description, montant...">
                    </div>
                    <div class="filter-controls">
                        <select id="expense-category-filter">
                            <option value="all">Toutes les cat√©gories</option>
                            <option value="equipement">√âquipement</option>
                            <option value="deplacement">D√©placement</option>
                            <option value="formation">Formation</option>
                            <option value="location">Location</option>
                            <option value="autre">Autre</option>
                        </select>
                        <select id="expense-period-filter">
                            <option value="all">Toutes les p√©riodes</option>
                            <option value="this-month">Ce mois</option>
                            <option value="last-month">Mois dernier</option>
                            <option value="this-quarter">Ce trimestre</option>
                            <option value="this-year">Cette ann√©e</option>
                        </select>
                        <select id="expense-sort">
                            <option value="date-desc">Plus r√©centes</option>
                            <option value="date-asc">Plus anciennes</option>
                            <option value="amount-desc">Montant (‚Üì)</option>
                            <option value="amount-asc">Montant (‚Üë)</option>
                        </select>
                    </div>
                </div>

                <div class="list-actions">
                    <button id="export-excel-expenses-btn" class="btn-secondary">Export Excel</button>
                    <div class="expense-summary">
                        Total: <span id="expenses-total" class="total-amount">0.00 $</span>
                    </div>
                </div>
                <div id="expenses-list" class="list-container">
                    <p class="empty-state">Aucune d√©pense enregistr√©e</p>
                </div>
            </section>
        </div>

        <!-- Section Param√®tres -->
        <div id="parametres-tab" class="tab-content">
            <section class="card">
                <h2>Mon Profil</h2>
                <p class="info-text">Configurez vos informations professionnelles qui appara√Ætront sur vos factures.</p>
                <form id="profile-form">
                    <div class="form-group">
                        <label for="profile-name">Nom complet / Nom de l'entreprise: *</label>
                        <input type="text" id="profile-name" required placeholder="Ex: Jean Dupont ou Mon Entreprise Inc.">
                    </div>

                    <div class="form-group">
                        <label for="profile-business-type">Type d'activit√©: *</label>
                        <input type="text" id="profile-business-type" required placeholder="Ex: Instructeur Yoga, Consultant, Designer">
                    </div>

                    <div class="form-group">
                        <label for="profile-service-label">Libell√© de vos services: *</label>
                        <input type="text" id="profile-service-label" required placeholder="Ex: Sessions, Cours, Consultations, Prestations">
                        <small>Ce terme appara√Ætra sur vos factures (ex: "Sessions de coaching")</small>
                    </div>

                    <div class="form-group">
                        <label for="profile-address">Adresse compl√®te: *</label>
                        <input type="text" id="profile-address" required placeholder="Ex: 123 rue Principale, Ville QC A1B 2C3">
                    </div>

                    <div class="form-group">
                        <label for="profile-phone">T√©l√©phone: *</label>
                        <input type="tel" id="profile-phone" required placeholder="Ex: 514-123-4567">
                    </div>

                    <div class="form-group">
                        <label for="profile-email">Email: *</label>
                        <input type="email" id="profile-email" required placeholder="Ex: contact@exemple.com">
                    </div>

                    <div class="form-group">
                        <label for="profile-payment-method">Modalit√© de paiement: *</label>
                        <input type="text" id="profile-payment-method" required placeholder="Ex: Virement Interac, Ch√®que, PayPal">
                    </div>

                    <h3 style="margin-top: 2rem; margin-bottom: 1rem; color: var(--primary-color);">Taxes (optionnel)</h3>
                    <p class="info-text">Si vous devez facturer des taxes (TPS/TVQ), activez cette option et entrez vos num√©ros d'entreprise.</p>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" id="profile-enable-taxes" style="width: auto;">
                            Activer les taxes sur mes factures
                        </label>
                    </div>

                    <div id="tax-fields" style="display: none;">
                        <div class="form-group">
                            <label for="profile-tps-number">Num√©ro de TPS (optionnel):</label>
                            <input type="text" id="profile-tps-number" placeholder="Ex: 123456789 RT0001">
                            <small>Appara√Ætra sur vos factures si vous facturez la TPS</small>
                        </div>

                        <div class="form-group">
                            <label for="profile-tvq-number">Num√©ro de TVQ (optionnel):</label>
                            <input type="text" id="profile-tvq-number" placeholder="Ex: 1234567890 TQ0001">
                            <small>Appara√Ætra sur vos factures si vous facturez la TVQ</small>
                        </div>

                        <div class="form-group">
                            <label for="profile-tps-rate">Taux TPS (%):</label>
                            <input type="number" id="profile-tps-rate" step="0.001" min="0" max="100" value="5" placeholder="5">
                            <small>Taux par d√©faut: 5%</small>
                        </div>

                        <div class="form-group">
                            <label for="profile-tvq-rate">Taux TVQ (%):</label>
                            <input type="number" id="profile-tvq-rate" step="0.001" min="0" max="100" value="9.975" placeholder="9.975">
                            <small>Taux par d√©faut au Qu√©bec: 9.975%</small>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-primary">Sauvegarder le profil</button>
                    </div>
                </form>

                <div id="profile-status" class="profile-status" style="display: none; margin-top: 15px; padding: 10px; border-radius: 5px;"></div>
            </section>

            <section class="card">
                <h2>Mes Clients</h2>
                <p class="info-text">G√©rez votre liste de clients pour gagner du temps lors de la cr√©ation de factures.</p>

                <div class="list-actions">
                    <button id="add-client-btn" class="btn-secondary">+ Ajouter un client</button>
                </div>

                <div id="clients-list" class="list-container">
                    <p class="empty-state">Aucun client enregistr√©</p>
                </div>

                <!-- Formulaire d'ajout de client (cach√© par d√©faut) -->
                <div id="client-form-container" style="display: none; margin-top: 1.5rem; padding: 1rem; background: var(--background); border-radius: var(--border-radius);">
                    <h3 style="margin-bottom: 1rem;">Nouveau client</h3>
                    <form id="client-form">
                        <div class="form-group">
                            <label for="new-client-name">Nom: *</label>
                            <input type="text" id="new-client-name" required placeholder="Nom du client">
                        </div>

                        <div class="form-group">
                            <label for="new-client-email">Email: *</label>
                            <input type="email" id="new-client-email" required placeholder="client@example.com">
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn-primary">Sauvegarder</button>
                            <button type="button" id="cancel-client-btn" class="btn-secondary">Annuler</button>
                        </div>
                    </form>
                </div>
            </section>
        </div>
    </div>

    <!-- Scripts Firebase -->
    <script src="firebase-config.js"></script>
    <script src="firebase-auth.js"></script>
    <script src="app.js"></script>
</body>
</html>
